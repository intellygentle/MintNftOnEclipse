"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.initialize = void 0;
const umi_1 = require("@metaplex-foundation/umi");
const extensions_1 = require("./extensions");
const write_1 = require("./write");
const allocate_1 = require("./generated/instructions/allocate");
function initialize(context, input) {
    const data = (0, extensions_1.getExtensionSerializerFromType)(input.extension.type).serialize(input.extension);
    const chunked = data.length > write_1.DEFAULT_CHUNK_SIZE;
    const builder = (0, allocate_1.allocate)(context, {
        ...input,
        extension: {
            extensionType: input.extension.type,
            length: data.length,
            data: chunked ? null : (0, umi_1.some)(data),
        },
    });
    if (chunked) {
        return (0, write_1.write)(context, {
            ...input,
            data,
        })
            .prepend(builder)
            .sequential();
    }
    return (0, umi_1.transactionBuilderGroup)([builder]);
}
exports.initialize = initialize;
//# sourceMappingURL=initialize.js.map